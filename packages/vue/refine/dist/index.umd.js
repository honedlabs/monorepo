(function(s,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("vue"),require("@inertiajs/vue3")):typeof define=="function"&&define.amd?define(["exports","vue","@inertiajs/vue3"],a):(s=typeof globalThis<"u"?globalThis:s||self,a(s["@honed/refine"]={},s.Vue,s.Inertia))})(this,function(s,a,d){"use strict";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const P=()=>{};function z(u,c){function i(...r){return new Promise((f,l)=>{Promise.resolve(u(()=>c.apply(this,r),{fn:c,thisArg:this,args:r})).then(f).catch(l)})}return i}function B(u,c={}){let i,r,f=P;const l=m=>{clearTimeout(m),f(),f=P};let b;return m=>{const _=a.toValue(u),p=a.toValue(c.maxWait);return i&&l(i),_<=0||p!==void 0&&p<=0?(r&&(l(r),r=null),Promise.resolve(m())):new Promise((h,v)=>{f=c.rejectOnCancel?v:h,b=m,p&&!r&&(r=setTimeout(()=>{i&&l(i),r=null,h(b())},p)),i=setTimeout(()=>{r&&l(r),r=null,h(m())},_)})}}function S(u,c=200,i={}){return z(B(c,i),u)}function H(u,c,i={}){if(!(u!=null&&u[c]))throw new Error("The refine must be provided with valid props and key.");const r=a.computed(()=>u[c]),f=a.computed(()=>!!r.value._sort_key),l=a.computed(()=>!!r.value._search_key),b=a.computed(()=>!!r.value._match_key),k=a.computed(()=>{var e;return(e=r.value.filters)==null?void 0:e.map(n=>({...n,apply:(t,o={})=>V(n,t,o),clear:(t={})=>q(n,t),bind:()=>D(n.name)}))}),m=a.computed(()=>{var e;return(e=r.value.sorts)==null?void 0:e.map(n=>({...n,apply:(t={})=>A(n,n.direction,t),clear:(t={})=>C(t),bind:()=>G(n)}))}),_=a.computed(()=>{var e;return(e=r.value.searches)==null?void 0:e.map(n=>({...n,apply:(t={})=>x(n,t),clear:(t={})=>x(n,t),bind:()=>I(n)}))}),p=a.computed(()=>k.value.filter(({active:e})=>e)),h=a.computed(()=>m.value.find(({active:e})=>e)),v=a.computed(()=>_.value.filter(({active:e})=>e));function F(e){return Array.isArray(e)?e.join(r.value._delimiter):e}function R(e){return typeof e!="string"?e:e.trim().replace(/\s+/g,"+")}function j(e){if(!["",null,void 0,[]].includes(e))return e}function E(e){return[F,R,j].reduce((n,t)=>t(n),e)}function W(e,n){return n=Array.isArray(n)?n:[n],n.includes(e)?n.filter(t=>t!==e):[...n,e]}function O(e){return typeof e!="string"?e:k.value.find(({name:n})=>n===e)}function T(e,n=null){return typeof e!="string"?e:m.value.find(({name:t,direction:o})=>t===e&&o===n)}function M(e){return typeof e!="string"?e:_.value.find(({name:n})=>n===e)}function K(e){return e?typeof e=="string"?p.value.some(n=>n.name===e):e.active:!!p.value.length}function L(e){var n;return e?typeof e=="string"?((n=h.value)==null?void 0:n.name)===e:e.active:!!h.value}function U(e){var n;return e?typeof e=="string"?(n=v.value)==null?void 0:n.some(t=>t.name===e):e.active:!!r.value.term}function N(e,n={}){const t=Object.fromEntries(Object.entries(e).map(([o,y])=>[o,E(y)]));d.router.reload({...i,...n,data:t})}function V(e,n,t={}){const o=O(e);if(!o)return console.warn(`Filter [${e}] does not exist.`);d.router.reload({...i,...t,data:{[o.name]:E(n)}})}function A(e,n=null,t={}){if(!f.value)return console.warn("Refine cannot perform sorting.");const o=T(e,n);if(!o)return console.warn(`Sort [${e}] does not exist.`);d.router.reload({...i,...t,data:{[r.value._sort_key]:j(o.next)}})}function $(e,n={}){if(!l.value)return console.warn("Refine cannot perform searching.");e=[R,j].reduce((t,o)=>o(t),e),d.router.reload({...i,...n,data:{[r.value._search_key]:e}})}function x(e,n={}){if(!b.value||!l.value)return console.warn("Refine cannot perform matching.");const t=M(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const o=W(t.name,v.value.map(({name:y})=>y));d.router.reload({...i,...n,data:{[r.value._match_key]:F(o)}})}function q(e,n={}){if(e)return V(e,null,n);d.router.reload({...i,...n,data:Object.fromEntries(p.value.map(({name:t})=>[t,null]))})}function C(e={}){if(!f.value)return console.warn("Refine cannot perform sorting.");d.router.reload({...i,...e,data:{[r.value._sort_key]:null}})}function Q(e={}){$(null,e)}function X(e={}){if(!b.value)return console.warn("Refine cannot perform matching.");d.router.reload({...i,...e,data:{[r.value._match_key]:null}})}function Y(e={}){var n;d.router.reload({...i,...e,data:{[r.value._search_key??""]:void 0,[r.value._sort_key??""]:void 0,[r.value._match_key??""]:void 0,...Object.fromEntries(((n=r.value.filters)==null?void 0:n.map(t=>[t.name,void 0]))??[])}})}function D(e,n={}){const t=O(e);if(!t)return console.warn(`Filter [${e}] does not exist.`);const{debounce:o=150,transform:y=g=>g,...w}=n;return{"onUpdate:modelValue":S(g=>{V(t,y(g),w)},o),modelValue:t.value}}function G(e,n={}){if(!f.value)return console.warn("Refine cannot perform sorting.");const t=T(e);if(!t)return console.warn(`Sort [${e}] does not exist.`);const{debounce:o=0,transform:y,...w}=n;return{onClick:S(()=>{var g;A(t,(g=h.value)==null?void 0:g.direction,w)},o)}}function Z(e={}){if(!l.value)return console.warn("Refine cannot perform searching.");const{debounce:n=700,transform:t,...o}=e;return{"onUpdate:modelValue":S(y=>{$(y,o)},n),modelValue:r.value.term??""}}function I(e,n={}){if(!b.value)return console.warn("Refine cannot perform matching.");const t=M(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const{debounce:o=0,transform:y,...w}=n;return{"onUpdate:modelValue":S(g=>{x(g,w)},o),modelValue:U(t),value:t.name}}return{filters:k,sorts:m,searches:_,currentFilters:p,currentSort:h,currentSearches:v,isSortable:f,isSearchable:l,isMatchable:b,isFiltering:K,isSorting:L,isSearching:U,getFilter:O,getSort:T,getSearch:M,apply:N,applyFilter:V,applySort:A,applySearch:$,applyMatch:x,clearFilter:q,clearSort:C,clearSearch:Q,clearMatch:X,reset:Y,bindFilter:D,bindSort:G,bindSearch:Z,bindMatch:I,stringValue:R,omitValue:j,toggleValue:W,delimitArray:F}}function J(u,c){return u?typeof u=="object"?(u==null?void 0:u.type)===c:u===c:!1}s.is=J,s.useRefine=H,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
