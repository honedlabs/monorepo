(function(p,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("vue"),require("@inertiajs/vue3")):typeof define=="function"&&define.amd?define(["exports","vue","@inertiajs/vue3"],u):(p=typeof globalThis<"u"?globalThis:p||self,u(p["@honed/refine"]={},p.Vue,p.Inertia))})(this,function(p,u,m){"use strict";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const E=()=>{};function B(c,s){function i(...r){return new Promise((y,f)=>{Promise.resolve(c(()=>s.apply(this,r),{fn:s,thisArg:this,args:r})).then(y).catch(f)})}return i}function H(c,s={}){let i,r,y=E;const f=h=>{clearTimeout(h),y(),y=E};let b;return h=>{const _=u.toValue(c),v=u.toValue(s.maxWait);return i&&f(i),_<=0||v!==void 0&&v<=0?(r&&(f(r),r=null),Promise.resolve(h())):new Promise((g,w)=>{y=s.rejectOnCancel?w:g,b=h,v&&!r&&(r=setTimeout(()=>{i&&f(i),r=null,g(b())},v)),i=setTimeout(()=>{r&&f(r),r=null,g(h())},_)})}}function O(c,s=200,i={}){return B(H(s,i),c)}function J(c,s,i={}){if(!(c!=null&&c[s]))throw new Error("The refine must be provided with valid props and key.");const r=u.computed(()=>c[s]),y=u.computed(()=>r.value.term),f=u.computed(()=>!!r.value._sort_key),b=u.computed(()=>!!r.value._search_key),S=u.computed(()=>!!r.value._match_key),h=u.computed(()=>{var e;return(e=r.value.filters)==null?void 0:e.map(n=>({...n,apply:(t,o={})=>j(n,t,o),clear:(t={})=>C(n,t),bind:()=>G(n.name)}))}),_=u.computed(()=>{var e;return(e=r.value.sorts)==null?void 0:e.map(n=>({...n,apply:(t={})=>$(n,n.direction,t),clear:(t={})=>D(t),bind:()=>I(n)}))}),v=u.computed(()=>{var e;return(e=r.value.searches)==null?void 0:e.map(n=>({...n,apply:(t={})=>V(n,t),clear:(t={})=>V(n,t),bind:()=>z(n)}))}),g=u.computed(()=>h.value.filter(({active:e})=>e)),w=u.computed(()=>_.value.find(({active:e})=>e)),x=u.computed(()=>v.value.filter(({active:e})=>e));function F(e){return Array.isArray(e)?e.join(r.value._delimiter):e}function R(e){return typeof e!="string"?e:e.trim().replace(/\s+/g,"+")}function k(e){if(!["",null,void 0,[]].includes(e))return e}function W(e){return[F,R,k].reduce((n,t)=>t(n),e)}function U(e,n){return n=Array.isArray(n)?n:[n],n.includes(e)?n.filter(t=>t!==e):[...n,e]}function T(e){return typeof e!="string"?e:h.value.find(({name:n})=>n===e)}function M(e,n=null){return typeof e!="string"?e:_.value.find(({name:t,direction:o})=>t===e&&o===n)}function A(e){return typeof e!="string"?e:v.value.find(({name:n})=>n===e)}function L(e){return e?typeof e=="string"?g.value.some(n=>n.name===e):e.active:!!g.value.length}function N(e){var n;return e?typeof e=="string"?((n=w.value)==null?void 0:n.name)===e:e.active:!!w.value}function q(e){var n;return e?typeof e=="string"?(n=x.value)==null?void 0:n.some(t=>t.name===e):e.active:!!y.value}function Q(e,n={}){const t=Object.fromEntries(Object.entries(e).map(([o,a])=>[o,W(a)]));m.router.reload({...i,...n,data:t})}function j(e,n,t={}){const o=T(e);if(!o)return console.warn(`Filter [${e}] does not exist.`);const{parameters:a,...l}=t;m.router.reload({...i,...l,data:{[o.name]:W(n),...a}})}function $(e,n=null,t={}){if(!f.value)return console.warn("Refine cannot perform sorting.");const o=M(e,n);if(!o)return console.warn(`Sort [${e}] does not exist.`);const{parameters:a,...l}=t;m.router.reload({...i,...l,data:{[r.value._sort_key]:k(o.next),...a}})}function P(e,n={}){if(!b.value)return console.warn("Refine cannot perform searching.");e=[R,k].reduce((a,l)=>l(a),e);const{parameters:t,...o}=n;m.router.reload({...i,...o,data:{[r.value._search_key]:e,...t}})}function V(e,n={}){if(!S.value||!b.value)return console.warn("Refine cannot perform matching.");const t=A(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const o=U(t.name,x.value.map(({name:d})=>d)),{parameters:a,...l}=n;m.router.reload({...i,...l,data:{[r.value._match_key]:F(o),...a}})}function C(e,n={}){if(e)return j(e,null,n);const{parameters:t,...o}=n;m.router.reload({...i,...o,data:{...Object.fromEntries(g.value.map(({name:a})=>[a,null])),...t}})}function D(e={}){if(!f.value)return console.warn("Refine cannot perform sorting.");const{parameters:n,...t}=e;m.router.reload({...i,...t,data:{[r.value._sort_key]:null,...n}})}function X(e={}){P(null,e)}function Y(e={}){if(!S.value)return console.warn("Refine cannot perform matching.");const{parameters:n,...t}=e;m.router.reload({...i,...t,data:{[r.value._match_key]:null,...n}})}function Z(e={}){var o;const{parameters:n,...t}=e;m.router.reload({...i,...t,data:{[r.value._search_key??""]:void 0,[r.value._sort_key??""]:void 0,[r.value._match_key??""]:void 0,...Object.fromEntries(((o=r.value.filters)==null?void 0:o.map(a=>[a.name,void 0]))??[]),...n}})}function G(e,n={}){const t=T(e);if(!t)return console.warn(`Filter [${e}] does not exist.`);const{debounce:o=150,transform:a=d=>d,...l}=n;return{"onUpdate:modelValue":O(d=>{j(t,a(d),l)},o),modelValue:t.value}}function I(e,n={}){if(!f.value)return console.warn("Refine cannot perform sorting.");const t=M(e);if(!t)return console.warn(`Sort [${e}] does not exist.`);const{debounce:o=0,transform:a,...l}=n;return{onClick:O(()=>{var d;$(t,(d=w.value)==null?void 0:d.direction,l)},o)}}function ee(e={}){if(!b.value)return console.warn("Refine cannot perform searching.");const{debounce:n=700,transform:t,...o}=e;return{"onUpdate:modelValue":O(a=>{P(a,o)},n),modelValue:y.value??""}}function z(e,n={}){if(!S.value)return console.warn("Refine cannot perform matching.");const t=A(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const{debounce:o=0,transform:a,...l}=n;return{"onUpdate:modelValue":O(d=>{V(d,l)},o),modelValue:q(t),value:t.name}}return{filters:h,sorts:_,searches:v,currentFilters:g,currentSort:w,currentSearches:x,searchTerm:y,isSortable:f,isSearchable:b,isMatchable:S,isFiltering:L,isSorting:N,isSearching:q,getFilter:T,getSort:M,getSearch:A,apply:Q,applyFilter:j,applySort:$,applySearch:P,applyMatch:V,clearFilter:C,clearSort:D,clearSearch:X,clearMatch:Y,reset:Z,bindFilter:G,bindSort:I,bindSearch:ee,bindMatch:z,stringValue:R,omitValue:k,toggleValue:U,delimitArray:F}}function K(c,s){return c?typeof c=="object"?(c==null?void 0:c.type)===s:c===s:!1}p.is=K,p.useRefine=J,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
