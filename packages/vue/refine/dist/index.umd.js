(function(y,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("vue"),require("@inertiajs/vue3")):typeof define=="function"&&define.amd?define(["exports","vue","@inertiajs/vue3"],u):(y=typeof globalThis<"u"?globalThis:y||self,u(y["@honed/refine"]={},y.Vue,y.Inertia))})(this,function(y,u,h){"use strict";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const W=()=>{};function H(c,l){function i(...s){return new Promise((o,d)=>{Promise.resolve(c(()=>l.apply(this,s),{fn:l,thisArg:this,args:s})).then(o).catch(d)})}return i}function J(c,l={}){let i,s,o=W;const d=p=>{clearTimeout(p),o(),o=W};let g;return p=>{const _=u.toValue(c),v=u.toValue(l.maxWait);return i&&d(i),_<=0||v!==void 0&&v<=0?(s&&(d(s),s=null),Promise.resolve(p())):new Promise((b,w)=>{o=l.rejectOnCancel?w:b,g=p,v&&!s&&(s=setTimeout(()=>{i&&d(i),s=null,b(g())},v)),i=setTimeout(()=>{s&&d(s),s=null,b(p())},_)})}}function O(c,l=200,i={}){return H(J(l,i),c)}function K(c,l,i={},s={}){if(!(c!=null&&c[l]))throw new Error("The refine must be provided with valid props and key.");const o=u.computed(()=>c[l]),d=u.computed(()=>o.value.term),g=u.computed(()=>!!o.value._sort_key),S=u.computed(()=>!!o.value._search_key),p=u.computed(()=>!!o.value._match_key),_=u.computed(()=>{var e;return(e=o.value.filters)==null?void 0:e.map(n=>({...n,apply:(t,r={})=>V(n,t,r),clear:(t={})=>D(n,t),bind:()=>I(n.name)}))}),v=u.computed(()=>{var e;return(e=o.value.sorts)==null?void 0:e.map(n=>({...n,apply:(t={})=>P(n,n.direction,t),clear:(t={})=>G(t),bind:()=>z(n)}))}),b=u.computed(()=>{var e;return(e=o.value.searches)==null?void 0:e.map(n=>({...n,apply:(t={})=>x(n,t),clear:(t={})=>x(n,t),bind:()=>B(n)}))}),w=u.computed(()=>_.value.filter(({active:e})=>e)),k=u.computed(()=>v.value.find(({active:e})=>e)),F=u.computed(()=>b.value.filter(({active:e})=>e));function R(e){return Array.isArray(e)?e.join(o.value._delimiter):e}function T(e){return typeof e!="string"?e:e.trim().replace(/\s+/g,"+")}function j(e){if(!["",null,void 0,[]].includes(e))return e}function U(e){return[R,T,j].reduce((n,t)=>t(n),e)}function q(e,n){return n=Array.isArray(n)?n:[n],n.includes(e)?n.filter(t=>t!==e):[...n,e]}function M(e){return typeof e!="string"?e:_.value.find(({name:n})=>n===e)}function A(e,n=null){return typeof e!="string"?e:v.value.find(({name:t,direction:r})=>t===e&&r===n)}function $(e){return typeof e!="string"?e:b.value.find(({name:n})=>n===e)}function N(e){return e?typeof e=="string"?w.value.some(n=>n.name===e):e.active:!!w.value.length}function Q(e){var n;return e?typeof e=="string"?((n=k.value)==null?void 0:n.name)===e:e.active:!!k.value}function C(e){var n;return e?typeof e=="string"?(n=F.value)==null?void 0:n.some(t=>t.name===e):e.active:!!d.value}function X(e,n={}){const t=Object.fromEntries(Object.entries(e).map(([r,a])=>[r,U(a)]));h.router.reload({...i,...n,data:t})}function V(e,n,t={}){const r=M(e);if(!r)return console.warn(`Filter [${e}] does not exist.`);const{parameters:a,...f}=t;h.router.reload({...i,...f,data:{[r.name]:U(n),...a,...s}})}function P(e,n=null,t={}){if(!g.value)return console.warn("Refine cannot perform sorting.");const r=A(e,n);if(!r)return console.warn(`Sort [${e}] does not exist.`);const{parameters:a,...f}=t;h.router.reload({...i,...f,data:{[o.value._sort_key]:j(r.next),...a}})}function E(e,n={}){if(!S.value)return console.warn("Refine cannot perform searching.");e=[T,j].reduce((a,f)=>f(a),e);const{parameters:t,...r}=n;h.router.reload({...i,...r,data:{[o.value._search_key]:e,...t,...s}})}function x(e,n={}){if(!p.value||!S.value)return console.warn("Refine cannot perform matching.");const t=$(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const r=q(t.name,F.value.map(({name:m})=>m)),{parameters:a,...f}=n;h.router.reload({...i,...f,data:{[o.value._match_key]:R(r),...a,...s}})}function D(e,n={}){if(e)return V(e,null,n);const{parameters:t,...r}=n;h.router.reload({...i,...r,data:{...Object.fromEntries(w.value.map(({name:a})=>[a,null])),...t}})}function G(e={}){if(!g.value)return console.warn("Refine cannot perform sorting.");const{parameters:n,...t}=e;h.router.reload({...i,...t,data:{[o.value._sort_key]:null,...n}})}function Y(e={}){E(null,e)}function Z(e={}){if(!p.value)return console.warn("Refine cannot perform matching.");const{parameters:n,...t}=e;h.router.reload({...i,...t,data:{[o.value._match_key]:null,...n}})}function ee(e={}){var r;const{parameters:n,...t}=e;h.router.reload({...i,...t,data:{[o.value._search_key??""]:void 0,[o.value._sort_key??""]:void 0,[o.value._match_key??""]:void 0,...Object.fromEntries(((r=o.value.filters)==null?void 0:r.map(a=>[a.name,void 0]))??[]),...n}})}function I(e,n={}){const t=M(e);if(!t)return console.warn(`Filter [${e}] does not exist.`);const{debounce:r=150,transform:a=m=>m,...f}=n;return{"onUpdate:modelValue":O(m=>{V(t,a(m),f)},r),modelValue:t.value}}function z(e,n={}){if(!g.value)return console.warn("Refine cannot perform sorting.");const t=A(e);if(!t)return console.warn(`Sort [${e}] does not exist.`);const{debounce:r=0,transform:a,...f}=n;return{onClick:O(()=>{var m;P(t,(m=k.value)==null?void 0:m.direction,f)},r)}}function ne(e={}){if(!S.value)return console.warn("Refine cannot perform searching.");const{debounce:n=700,transform:t,...r}=e;return{"onUpdate:modelValue":O(a=>{E(a,r)},n),modelValue:d.value??""}}function B(e,n={}){if(!p.value)return console.warn("Refine cannot perform matching.");const t=$(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const{debounce:r=0,transform:a,...f}=n;return{"onUpdate:modelValue":O(m=>{x(m,f)},r),modelValue:C(t),value:t.name}}return{filters:_,sorts:v,searches:b,currentFilters:w,currentSort:k,currentSearches:F,searchTerm:d,isSortable:g,isSearchable:S,isMatchable:p,isFiltering:N,isSorting:Q,isSearching:C,getFilter:M,getSort:A,getSearch:$,apply:X,applyFilter:V,applySort:P,applySearch:E,applyMatch:x,clearFilter:D,clearSort:G,clearSearch:Y,clearMatch:Z,reset:ee,bindFilter:I,bindSort:z,bindSearch:ne,bindMatch:B,stringValue:T,omitValue:j,toggleValue:q,delimitArray:R}}function L(c,l){return c?typeof c=="object"?(c==null?void 0:c.type)===l:c===l:!1}y.is=L,y.useRefine=K,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
