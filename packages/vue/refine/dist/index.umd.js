(function(h,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("vue"),require("@inertiajs/vue3")):typeof define=="function"&&define.amd?define(["exports","vue","@inertiajs/vue3"],c):(h=typeof globalThis<"u"?globalThis:h||self,c(h["@honed/refine"]={},h.Vue,h.Inertia))})(this,function(h,c,g){"use strict";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const G=()=>{};function Q(f,p){function v(...d){return new Promise((i,m)=>{Promise.resolve(f(()=>p.apply(this,d),{fn:p,thisArg:this,args:d})).then(i).catch(m)})}return v}function X(f,p={}){let v,d,i=G;const m=b=>{clearTimeout(b),i(),i=G};let a;return b=>{const O=c.toValue(f),_=c.toValue(p.maxWait);return v&&m(v),O<=0||_!==void 0&&_<=0?(d&&(m(d),d=null),Promise.resolve(b())):new Promise((w,k)=>{i=p.rejectOnCancel?k:w,a=b,_&&!d&&(d=setTimeout(()=>{v&&m(v),d=null,w(a())},_)),v=setTimeout(()=>{d&&m(d),d=null,w(b())},O)})}}function j(f,p=200,v={}){return Q(X(p,v),f)}function Y(f,p,v={},d={}){if(!(f!=null&&f[p]))throw new Error("The refine must be provided with valid props and key.");const{onFinish:i,...m}=v,a=c.ref(!1),s=c.computed(()=>f[p]),b=c.computed(()=>s.value.term),O=c.computed(()=>!!s.value._sort_key),_=c.computed(()=>!!s.value._search_key),w=c.computed(()=>!!s.value._match_key),k=c.computed(()=>{var e;return(e=s.value.filters)==null?void 0:e.map(n=>({...n,apply:(t,r={})=>S(n,t,r),clear:(t={})=>H(n,t),bind:(t={})=>K(n.name,t)}))}),M=c.computed(()=>{var e;return(e=s.value.sorts)==null?void 0:e.map(n=>({...n,apply:(t={})=>q(n,n.direction,t),clear:(t={})=>J(t),bind:(t={})=>L(n,t)}))}),A=c.computed(()=>{var e;return(e=s.value.searches)==null?void 0:e.map(n=>({...n,apply:(t={})=>T(n,t),clear:(t={})=>T(n,t),bind:(t={})=>N(n,t)}))}),V=c.computed(()=>k.value.filter(({active:e})=>e)),x=c.computed(()=>M.value.find(({active:e})=>e)),$=c.computed(()=>A.value.filter(({active:e})=>e));function P(e){return Array.isArray(e)?e.join(s.value._delimiter):e}function E(e){return typeof e!="string"?e:e.trim().replace(/\s+/g,"+")}function R(e){if(!["",null,void 0,[]].includes(e))return e}function I(e){return[P,E,R].reduce((n,t)=>t(n),e)}function z(e,n){return n=Array.isArray(n)?n:[n],n.includes(e)?n.filter(t=>t!==e):[...n,e]}function F(e){return typeof e!="string"?e:k.value.find(({name:n})=>n===e)}function W(e,n=null){return typeof e!="string"?e:M.value.find(({name:t,direction:r})=>t===e&&r===n)}function U(e){return typeof e!="string"?e:A.value.find(({name:n})=>n===e)}function D(e){return e?typeof e=="string"?V.value.some(n=>n.name===e):e.active:!!V.value.length}function ee(e){var n;return e?typeof e=="string"?((n=x.value)==null?void 0:n.name)===e:e.active:!!x.value}function B(e){var n;return e?typeof e=="string"?(n=$.value)==null?void 0:n.some(t=>t.name===e):e.active:!!b.value}function ne(e,n={}){const t=Object.fromEntries(Object.entries(e).map(([o,l])=>[o,I(l)])),{onFinish:r,...u}=n;a.value=!0,g.router.reload({...m,...u,data:t,onFinish:o=>{a.value=!1,r==null||r(o),i==null||i(o)}})}function S(e,n,t={}){const r=F(e);if(!r)return console.warn(`Filter [${e}] does not exist.`);const{parameters:u,onFinish:o,...l}=t;a.value=!0,g.router.reload({...m,...l,onFinish:y=>{a.value=!1,o==null||o(y),i==null||i(y)},data:{[r.name]:I(n),...u,...d}})}function q(e,n=null,t={}){if(!O.value)return console.warn("Refine cannot perform sorting.");const r=W(e,n);if(!r)return console.warn(`Sort [${e}] does not exist.`);const{parameters:u,onFinish:o,...l}=t;a.value=!0,g.router.reload({...m,...l,onFinish:y=>{a.value=!1,o==null||o(y),i==null||i(y)},data:{[s.value._sort_key]:R(r.next),...u}})}function C(e,n={}){if(!_.value)return console.warn("Refine cannot perform searching.");e=[E,R].reduce((o,l)=>l(o),e);const{parameters:t,onFinish:r,...u}=n;a.value=!0,g.router.reload({...m,...u,onFinish:o=>{a.value=!1,r==null||r(o),i==null||i(o)},data:{[s.value._search_key]:e,...t,...d}})}function T(e,n={}){if(!w.value||!_.value)return console.warn("Refine cannot perform matching.");const t=U(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const r=z(t.name,$.value.map(({name:y})=>y)),{parameters:u,onFinish:o,...l}=n;a.value=!0,g.router.reload({...m,...l,onFinish:y=>{a.value=!1,o==null||o(y),i==null||i(y)},data:{[s.value._match_key]:P(r),...u,...d}})}function H(e,n={}){if(e)return S(e,null,n);const{parameters:t,onFinish:r,...u}=n;a.value=!0,g.router.reload({...m,...u,onFinish:o=>{a.value=!1,r==null||r(o),i==null||i(o)},data:{...Object.fromEntries(V.value.map(({name:o})=>[o,null])),...t}})}function J(e={}){if(!O.value)return console.warn("Refine cannot perform sorting.");const{parameters:n,onFinish:t,...r}=e;a.value=!0,g.router.reload({...m,...r,onFinish:u=>{a.value=!1,t==null||t(u),i==null||i(u)},data:{[s.value._sort_key]:null,...n}})}function te(e={}){C(null,e)}function re(e={}){if(!w.value)return console.warn("Refine cannot perform matching.");const{parameters:n,onFinish:t,...r}=e;a.value=!0,g.router.reload({...m,...r,onFinish:u=>{a.value=!1,t==null||t(u),i==null||i(u)},data:{[s.value._match_key]:null,...n}})}function oe(e={}){var u;const{parameters:n,onFinish:t,...r}=e;a.value=!0,g.router.reload({...m,...r,onFinish:o=>{a.value=!1,t==null||t(o),i==null||i(o)},data:{[s.value._search_key??""]:void 0,[s.value._sort_key??""]:void 0,[s.value._match_key??""]:void 0,...Object.fromEntries(((u=s.value.filters)==null?void 0:u.map(o=>[o.name,void 0]))??[]),...n}})}function K(e,n={}){const t=F(e);if(!t)return console.warn(`Filter [${e}] does not exist.`);const{debounce:r=150,transform:u=l=>l,...o}=n;return{"onUpdate:modelValue":j(l=>{S(t,u(l),o)},r),modelValue:t.value}}function L(e,n={}){if(!O.value)return console.warn("Refine cannot perform sorting.");const t=W(e);if(!t)return console.warn(`Sort [${e}] does not exist.`);const{debounce:r=0,transform:u,...o}=n;return{onClick:j(()=>{var l;q(t,(l=x.value)==null?void 0:l.direction,o)},r)}}function ie(e={}){if(!_.value)return console.warn("Refine cannot perform searching.");const{debounce:n=750,transform:t,...r}=e;return{"onUpdate:modelValue":j(u=>{C(u,r)},n),modelValue:b.value??""}}function N(e,n={}){if(!w.value)return console.warn("Refine cannot perform matching.");const t=U(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const{debounce:r=0,transform:u,...o}=n;return{"onUpdate:modelValue":j(l=>{T(l,o)},r),modelValue:B(t),value:t.name}}return{processing:a,filters:k,sorts:M,searches:A,currentFilters:V,currentSort:x,currentSearches:$,searchTerm:b,isSortable:O,isSearchable:_,isMatchable:w,isFiltering:D,isSorting:ee,isSearching:B,getFilter:F,getSort:W,getSearch:U,apply:ne,applyFilter:S,applySort:q,applySearch:C,applyMatch:T,clearFilter:H,clearSort:J,clearSearch:te,clearMatch:re,reset:oe,bindFilter:K,bindSort:L,bindSearch:ie,bindMatch:N,stringValue:E,omitValue:R,toggleValue:z,delimitArray:P}}function Z(f,p){return f?typeof f=="object"?(f==null?void 0:f.type)===p:f===p:!1}h.is=Z,h.useRefine=Y,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
