(function(h,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("vue"),require("@inertiajs/vue3")):typeof define=="function"&&define.amd?define(["exports","vue","@inertiajs/vue3"],u):(h=typeof globalThis<"u"?globalThis:h||self,u(h["@honed/refine"]={},h.Vue,h.Inertia))})(this,function(h,u,f){"use strict";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const W=()=>{};function z(a,c){function o(...r){return new Promise((s,l)=>{Promise.resolve(a(()=>c.apply(this,r),{fn:c,thisArg:this,args:r})).then(s).catch(l)})}return o}function B(a,c={}){let o,r,s=W;const l=d=>{clearTimeout(d),s(),s=W};let g;return d=>{const S=u.toValue(a),m=u.toValue(c.maxWait);return o&&l(o),S<=0||m!==void 0&&m<=0?(r&&(l(r),r=null),Promise.resolve(d())):new Promise((y,v)=>{s=c.rejectOnCancel?v:y,g=d,m&&!r&&(r=setTimeout(()=>{o&&l(o),r=null,y(g())},m)),o=setTimeout(()=>{r&&l(r),r=null,y(d())},S)})}}function x(a,c=200,o={}){return z(B(c,o),a)}function H(a,c,o={}){if(!(a!=null&&a[c]))throw new Error("The refine must be provided with valid props and key.");const r=u.computed(()=>a[c]),s=u.computed(()=>!!r.value.sort),l=u.computed(()=>!!r.value.search),g=u.computed(()=>!!r.value.match),V=u.computed(()=>{var e;return(e=r.value.filters)==null?void 0:e.map(n=>({...n,apply:(t,i={})=>F(n,t,i),clear:(t={})=>C(n,t),bind:()=>G(n.name)}))}),d=u.computed(()=>{var e;return(e=r.value.sorts)==null?void 0:e.map(n=>({...n,apply:(t={})=>P(n,n.direction,t),clear:(t={})=>D(t),bind:()=>I(n)}))}),S=u.computed(()=>{var e;return(e=r.value.searches)==null?void 0:e.map(n=>({...n,apply:(t={})=>O(n,t),clear:(t={})=>O(n,t),bind:()=>_(n)}))}),m=u.computed(()=>V.value.filter(({active:e})=>e)),y=u.computed(()=>d.value.find(({active:e})=>e)),v=u.computed(()=>S.value.filter(({active:e})=>e));function T(e){return Array.isArray(e)?e.join(r.value.delimiter):e}function R(e){return typeof e!="string"?e:e.trim().replace(/\s+/g,"+")}function j(e){if(!["",null,void 0,[]].includes(e))return e}function U(e){return[T,R,j].reduce((n,t)=>t(n),e)}function k(e,n){return n=Array.isArray(n)?n:[n],n.includes(e)?n.filter(t=>t!==e):[...n,e]}function M(e){return typeof e!="string"?e:V.value.find(({name:n})=>n===e)}function A(e,n=null){return typeof e!="string"?e:d.value.find(({name:t,direction:i})=>t===e&&i===n)}function $(e){return typeof e!="string"?e:S.value.find(({name:n})=>n===e)}function J(e){return e?typeof e=="string"?m.value.some(n=>n.name===e):e.active:!!m.value.length}function K(e){var n;return e?typeof e=="string"?((n=y.value)==null?void 0:n.name)===e:e.active:!!y.value}function q(e){var n;return e?typeof e=="string"?(n=v.value)==null?void 0:n.some(t=>t.name===e):e.active:!!r.value.term}function L(e,n={}){const t=Object.fromEntries(Object.entries(e).map(([i,p])=>[i,U(p)]));f.router.reload({...o,...n,data:t})}function F(e,n,t={}){const i=M(e);if(!i)return console.warn(`Filter [${e}] does not exist.`);f.router.reload({...o,...t,data:{[i.name]:U(n)}})}function P(e,n=null,t={}){if(!s.value)return console.warn("Refine cannot perform sorting.");const i=A(e,n);if(!i)return console.warn(`Sort [${e}] does not exist.`);f.router.reload({...o,...t,data:{[r.value.sort]:j(i.next)}})}function E(e,n={}){if(!l.value)return console.warn("Refine cannot perform searching.");e=[R,j].reduce((t,i)=>i(t),e),f.router.reload({...o,...n,data:{[r.value.search]:e}})}function O(e,n={}){if(!g.value||!l.value)return console.warn("Refine cannot perform matching.");const t=$(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const i=k(t.name,v.value.map(({name:p})=>p));f.router.reload({...o,...n,data:{[r.value.match]:T(i)}})}function C(e,n={}){if(e)return F(e,null,n);f.router.reload({...o,...n,data:Object.fromEntries(m.value.map(({name:t})=>[t,null]))})}function D(e={}){if(!s.value)return console.warn("Refine cannot perform sorting.");f.router.reload({...o,...e,data:{[r.value.sort]:null}})}function N(e={}){E(null,e)}function Q(e={}){if(!g.value)return console.warn("Refine cannot perform matching.");f.router.reload({...o,...e,data:{[r.value.match]:null}})}function X(e={}){var n;f.router.reload({...o,...e,data:{[r.value.search??""]:void 0,[r.value.sort??""]:void 0,[r.value.match??""]:void 0,...Object.fromEntries(((n=r.value.filters)==null?void 0:n.map(t=>[t.name,void 0]))??[])}})}function G(e,n={}){const t=M(e);if(!t)return console.warn(`Filter [${e}] does not exist.`);const{debounce:i=250,transform:p=b=>b,...w}=n;return{"onUpdate:modelValue":x(b=>{F(t,p(b),w)},i),modelValue:t.value}}function I(e,n={}){const t=A(e);if(!t)return console.warn(`Sort [${e}] does not exist.`);const{debounce:i=0,transform:p,...w}=n;return{onClick:x(()=>{var b;P(t,(b=y.value)==null?void 0:b.direction,w)},i)}}function Y(e={}){const{debounce:n=700,transform:t,...i}=e;return{"onUpdate:modelValue":x(p=>{E(p,i)},n),modelValue:r.value.term??""}}function _(e,n={}){const t=$(e);if(!t)return console.warn(`Match [${e}] does not exist.`);const{debounce:i=0,transform:p,...w}=n;return{"onUpdate:modelValue":x(b=>{O(b,w)},i),modelValue:q(t),value:t.name}}return u.reactive({filters:V,sorts:d,searches:S,currentFilters:m,currentSort:y,currentSearches:v,isSortable:s,isSearchable:l,isMatchable:g,isFiltering:J,isSorting:K,isSearching:q,getFilter:M,getSort:A,getSearch:$,apply:L,applyFilter:F,applySort:P,applySearch:E,applyMatch:O,clearFilter:C,clearSort:D,clearSearch:N,clearMatch:Q,reset:X,bindFilter:G,bindSort:I,bindSearch:Y,bindMatch:_,stringValue:R,omitValue:j,toggleValue:k,delimitArray:T})}h.useRefine=H,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
