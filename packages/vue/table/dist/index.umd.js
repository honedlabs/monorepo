(function(w,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue"),require("@inertiajs/vue3"),require("axios")):typeof define=="function"&&define.amd?define(["exports","vue","@inertiajs/vue3","axios"],i):(w=typeof globalThis<"u"?globalThis:w||self,i(w["@honed/table"]={},w.Vue,w.Inertia,w.axios))})(this,function(w,i,b,Y){"use strict";function N(r,m={},c={}){if(!r.href||!r.method)return!1;if(r.type==="inertia")r.method==="delete"?b.router.delete(r.href,c):b.router[r.method](r.href,m,c);else{const d=s=>{var l;return(l=c.onError)==null?void 0:l.call(c,s)};r.method==="get"?window.location.href=r.href:r.method==="delete"?Y.delete(r.href).catch(d):Y[r.method](r.href,m).catch(d)}return!0}function ee(){const r=i.ref({all:!1,only:new Set,except:new Set});function m(){r.value.all=!0,r.value.only.clear(),r.value.except.clear()}function c(){r.value.all=!1,r.value.only.clear(),r.value.except.clear()}function d(...f){f.forEach(g=>r.value.except.delete(g)),f.forEach(g=>r.value.only.add(g))}function s(...f){f.forEach(g=>r.value.except.add(g)),f.forEach(g=>r.value.only.delete(g))}function l(f,g){if(k(f)||g===!1)return s(f);if(!k(f)||g===!0)return d(f)}function k(f){return r.value.all?!r.value.except.has(f):r.value.only.has(f)}const u=i.computed(()=>r.value.all&&r.value.except.size===0),_=i.computed(()=>r.value.only.size>0||u.value);function S(f){return{"onUpdate:modelValue":g=>{g?d(f):s(f)},modelValue:k(f),value:f}}function x(){return{"onUpdate:modelValue":f=>{f?m():c()},modelValue:u.value}}return{allSelected:u,selection:r,hasSelected:_,selectAll:m,deselectAll:c,select:d,deselect:s,toggle:l,selected:k,bind:S,bindAll:x}}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Z=()=>{};function te(r,m){function c(...d){return new Promise((s,l)=>{Promise.resolve(r(()=>m.apply(this,d),{fn:m,thisArg:this,args:d})).then(s).catch(l)})}return c}function ne(r,m={}){let c,d,s=Z;const l=u=>{clearTimeout(u),s(),s=Z};let k;return u=>{const _=i.toValue(r),S=i.toValue(m.maxWait);return c&&l(c),_<=0||S!==void 0&&S<=0?(d&&(l(d),d=null),Promise.resolve(u())):new Promise((x,f)=>{s=m.rejectOnCancel?f:x,k=u,S&&!d&&(d=setTimeout(()=>{c&&l(c),d=null,x(k())},S)),c=setTimeout(()=>{d&&l(d),d=null,x(u())},_)})}}function G(r,m=200,c={}){return te(ne(m,c),r)}function ae(r,m,c={},d={}){if(!(r!=null&&r[m]))throw new Error("The refine must be provided with valid props and key.");const s=i.computed(()=>r[m]),l=i.computed(()=>s.value.term),k=i.computed(()=>!!s.value._sort_key),u=i.computed(()=>!!s.value._search_key),_=i.computed(()=>!!s.value._match_key),S=i.computed(()=>{var t;return(t=s.value.filters)==null?void 0:t.map(a=>({...a,apply:(e,n={})=>v(a,e,n),clear:(e={})=>O(a,e),bind:()=>B(a.name)}))}),x=i.computed(()=>{var t;return(t=s.value.sorts)==null?void 0:t.map(a=>({...a,apply:(e={})=>V(a,a.direction,e),clear:(e={})=>q(e),bind:()=>J(a)}))}),f=i.computed(()=>{var t;return(t=s.value.searches)==null?void 0:t.map(a=>({...a,apply:(e={})=>A(a,e),clear:(e={})=>A(a,e),bind:()=>D(a)}))}),g=i.computed(()=>S.value.filter(({active:t})=>t)),P=i.computed(()=>x.value.find(({active:t})=>t)),E=i.computed(()=>f.value.filter(({active:t})=>t));function L(t){return Array.isArray(t)?t.join(s.value._delimiter):t}function j(t){return typeof t!="string"?t:t.trim().replace(/\s+/g,"+")}function R(t){if(!["",null,void 0,[]].includes(t))return t}function I(t){return[L,j,R].reduce((a,e)=>e(a),t)}function z(t,a){return a=Array.isArray(a)?a:[a],a.includes(t)?a.filter(e=>e!==t):[...a,t]}function M(t){return typeof t!="string"?t:S.value.find(({name:a})=>a===t)}function $(t,a=null){return typeof t!="string"?t:x.value.find(({name:e,direction:n})=>e===t&&n===a)}function U(t){return typeof t!="string"?t:f.value.find(({name:a})=>a===t)}function Q(t){return t?typeof t=="string"?g.value.some(a=>a.name===t):t.active:!!g.value.length}function y(t){var a;return t?typeof t=="string"?((a=P.value)==null?void 0:a.name)===t:t.active:!!P.value}function C(t){var a;return t?typeof t=="string"?(a=E.value)==null?void 0:a.some(e=>e.name===t):t.active:!!l.value}function K(t,a={}){const e=Object.fromEntries(Object.entries(t).map(([n,o])=>[n,I(o)]));b.router.reload({...c,...a,data:e})}function v(t,a,e={}){const n=M(t);if(!n)return console.warn(`Filter [${t}] does not exist.`);const{parameters:o,...p}=e;b.router.reload({...c,...p,data:{[n.name]:I(a),...o,...d}})}function V(t,a=null,e={}){if(!k.value)return console.warn("Refine cannot perform sorting.");const n=$(t,a);if(!n)return console.warn(`Sort [${t}] does not exist.`);const{parameters:o,...p}=e;b.router.reload({...c,...p,data:{[s.value._sort_key]:R(n.next),...o}})}function F(t,a={}){if(!u.value)return console.warn("Refine cannot perform searching.");t=[j,R].reduce((o,p)=>p(o),t);const{parameters:e,...n}=a;b.router.reload({...c,...n,data:{[s.value._search_key]:t,...e,...d}})}function A(t,a={}){if(!_.value||!u.value)return console.warn("Refine cannot perform matching.");const e=U(t);if(!e)return console.warn(`Match [${t}] does not exist.`);const n=z(e.name,E.value.map(({name:h})=>h)),{parameters:o,...p}=a;b.router.reload({...c,...p,data:{[s.value._match_key]:L(n),...o,...d}})}function O(t,a={}){if(t)return v(t,null,a);const{parameters:e,...n}=a;b.router.reload({...c,...n,data:{...Object.fromEntries(g.value.map(({name:o})=>[o,null])),...e}})}function q(t={}){if(!k.value)return console.warn("Refine cannot perform sorting.");const{parameters:a,...e}=t;b.router.reload({...c,...e,data:{[s.value._sort_key]:null,...a}})}function T(t={}){F(null,t)}function W(t={}){if(!_.value)return console.warn("Refine cannot perform matching.");const{parameters:a,...e}=t;b.router.reload({...c,...e,data:{[s.value._match_key]:null,...a}})}function H(t={}){var a;const{parameters:e,...n}=t;b.router.reload({...c,...n,data:{[s.value._search_key??""]:void 0,[s.value._sort_key??""]:void 0,[s.value._match_key??""]:void 0,...Object.fromEntries(((a=s.value.filters)==null?void 0:a.map(o=>[o.name,void 0]))??[]),...e}})}function B(t,a={}){const e=M(t);if(!e)return console.warn(`Filter [${t}] does not exist.`);const{debounce:n=150,transform:o=h=>h,...p}=a;return{"onUpdate:modelValue":G(h=>{v(e,o(h),p)},n),modelValue:e.value}}function J(t,a={}){if(!k.value)return console.warn("Refine cannot perform sorting.");const e=$(t);if(!e)return console.warn(`Sort [${t}] does not exist.`);const{debounce:n=0,transform:o,...p}=a;return{onClick:G(()=>{var h;V(e,(h=P.value)==null?void 0:h.direction,p)},n)}}function X(t={}){if(!u.value)return console.warn("Refine cannot perform searching.");const{debounce:a=700,transform:e,...n}=t;return{"onUpdate:modelValue":G(o=>{F(o,n)},a),modelValue:l.value??""}}function D(t,a={}){if(!_.value)return console.warn("Refine cannot perform matching.");const e=U(t);if(!e)return console.warn(`Match [${t}] does not exist.`);const{debounce:n=0,transform:o,...p}=a;return{"onUpdate:modelValue":G(h=>{A(h,p)},n),modelValue:C(e),value:e.name}}return{filters:S,sorts:x,searches:f,currentFilters:g,currentSort:P,currentSearches:E,searchTerm:l,isSortable:k,isSearchable:u,isMatchable:_,isFiltering:Q,isSorting:y,isSearching:C,getFilter:M,getSort:$,getSearch:U,apply:K,applyFilter:v,applySort:V,applySearch:F,applyMatch:A,clearFilter:O,clearSort:q,clearSearch:T,clearMatch:W,reset:H,bindFilter:B,bindSort:J,bindSearch:X,bindMatch:D,stringValue:j,omitValue:R,toggleValue:z,delimitArray:L}}function re(r,m,c={}){if(!(r!=null&&r[m]))throw new Error("The table must be provided with valid props and key.");const{recordOperations:d={},...s}={only:[...c.only??[],m.toString()],...c},l=i.computed(()=>r[m]),k=i.computed(()=>l.value._id),u=ee(),_=ae(r,m,s,{[l.value._page_key]:void 0}),S=i.computed(()=>l.value.meta),x=i.computed(()=>l.value.views??[]),f=i.computed(()=>l.value.state??null),g=i.computed(()=>l.value.placeholder??null),P=i.computed(()=>!!l.value.state),E=i.computed(()=>!!l.value._page_key&&!!l.value._record_key),L=i.computed(()=>!!l.value._column_key),j=i.computed(()=>l.value.columns.filter(({active:e,hidden:n})=>e&&!n).map(e=>{var n;return{...e,isSorting:!!((n=e.sort)!=null&&n.active),toggleSort:(o={})=>_.applySort(e.sort,null,o)}})),R=i.computed(()=>l.value.columns.filter(({hidden:e})=>!e).map(e=>({...e,toggle:(n={})=>X(e.name,n)}))),I=i.computed(()=>l.value.records.map(e=>({...e,operations:e.operations.map(n=>({...n,execute:(o={})=>W(n,e,o)})),selected:u.selected(v(e)),default:(n={})=>{const o=e.operations.find(({default:p})=>p);o&&W(o,e,n)},select:()=>u.select(v(e)),deselect:()=>u.deselect(v(e)),toggle:()=>u.toggle(v(e)),bind:()=>u.bind(v(e)),entry:n=>V(e,n),value:n=>F(e,n),extra:n=>A(e,n)}))),z=i.computed(()=>!!l.value.operations.inline),M=i.computed(()=>l.value.operations.bulk.map(e=>({...e,execute:(n={})=>H(e,n)}))),$=i.computed(()=>l.value.operations.page.map(e=>({...e,execute:(n={})=>B(e,n)}))),U=i.computed(()=>l.value.pages.find(({active:e})=>e)),Q=i.computed(()=>l.value.pages),y=i.computed(()=>({...l.value.paginate,next:(e={})=>{"nextLink"in y.value&&y.value.nextLink&&T(y.value.nextLink,e)},previous:(e={})=>{"prevLink"in y.value&&y.value.prevLink&&T(y.value.prevLink,e)},first:(e={})=>{"firstLink"in y.value&&y.value.firstLink&&T(y.value.firstLink,e)},last:(e={})=>{"lastLink"in y.value&&y.value.lastLink&&T(y.value.lastLink,e)},..."links"in l.value.paginate&&l.value.paginate.links?{links:l.value.paginate.links.map(e=>({...e,navigate:(n={})=>e.url&&T(e.url,n)}))}:{}})),C=i.computed(()=>l.value.records.length>0&&l.value.records.every(e=>u.selected(v(e))));function K(e){return typeof e=="string"?e:e.name}function v(e){return e._key}function V(e,n){const o=K(n);return e[o]}function F(e,n){var o;return((o=V(e,n))==null?void 0:o.v)??null}function A(e,n){var o;return(o=V(e,n))==null?void 0:o.e}function O(e){return{id:v(e)}}function q(){return{all:u.selection.value.all,only:Array.from(u.selection.value.only),except:Array.from(u.selection.value.except)}}function T(e,n={}){b.router.visit(e,{preserveScroll:!0,preserveState:!0,...s,...n,method:"get"})}function W(e,n,o={}){var h;N(e,O(n),{...c,...o})||(h=d==null?void 0:d[e.name])==null||h.call(d,n)}function H(e,n={}){return N(e,q(),{...c,...n,onSuccess:o=>{var p,h;(p=n.onSuccess)==null||p.call(n,o),(h=c.onSuccess)==null||h.call(c,o),console.log("onSuccess"),e.keep||u.deselectAll()}})}function B(e,n={},o={}){return N(e,n,{...c,...o})}function J(e,n={}){if(!E.value)return console.warn("The table does not support pagination changes.");b.router.reload({...s,...n,data:{[l.value._record_key]:e.value,[l.value._page_key]:void 0}})}function X(e,n={}){if(!L.value)return console.warn("The table does not support column toggling.");const o=K(e);if(!o)return console.log(`Column [${e}] does not exist.`);const p=_.toggleValue(o,j.value.map(({name:h})=>h));b.router.reload({...s,...n,data:{[l.value._column_key]:_.delimitArray(p)}})}function D(){u.select(...l.value.records.map(e=>v(e)))}function t(){u.deselect(...l.value.records.map(e=>v(e)))}function a(){return{"onUpdate:modelValue":e=>{e?D():t()},modelValue:C.value}}return i.reactive({id:k,meta:S,views:x,emptyState:f,placeholder:g,isEmpty:P,isPageable:E,isToggleable:L,getEntry:V,getValue:F,getExtra:A,getRecordKey:v,headings:j,columns:R,records:I,inline:z,bulk:M,page:$,pages:Q,currentPage:U,paginator:y,executeInline:W,executeBulk:H,executePage:B,getBulkData:q,getRecordData:O,applyPage:J,selection:u.selection,select:e=>u.select(v(e)),deselect:e=>u.deselect(v(e)),selectPage:D,deselectPage:t,toggle:e=>u.toggle(v(e)),selected:e=>u.selected(v(e)),selectAll:u.selectAll,deselectAll:u.deselectAll,isPageSelected:C,hasSelected:u.hasSelected,bindCheckbox:e=>u.bind(v(e)),bindPage:a,bindAll:u.bindAll,..._})}function le(r,m){return r?typeof r=="object"?r.type===m:r===m:!1}w.is=le,w.useTable=re,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
