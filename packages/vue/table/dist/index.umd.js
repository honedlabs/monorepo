(function(A,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("vue"),require("@inertiajs/vue3")):typeof define=="function"&&define.amd?define(["exports","vue","@inertiajs/vue3"],c):(A=typeof globalThis<"u"?globalThis:A||self,c(A["@honed/table"]={},A.Vue,A.Inertia))})(this,function(A,c,S){"use strict";function Y(r,f,s,l={}){return r.route?(S.router.visit(r.route.url,{...l,method:r.route.method}),!0):r.action&&f?(S.router.post(f,{...s,name:r.name,type:r.type},l),!0):!1}function H(r,f,s,l={},p={}){return Y(r,f,{...l,id:s??void 0},{...p})}function _(r,f,s,l={}){return r.map(p=>({...p,execute:(o={},u={})=>H(p,f,s,o,{...l,...u})}))}function Z(){const r=c.ref({all:!1,only:new Set,except:new Set});function f(){r.value.all=!0,r.value.only.clear(),r.value.except.clear()}function s(){r.value.all=!1,r.value.only.clear(),r.value.except.clear()}function l(...d){d.forEach(g=>r.value.except.delete(g)),d.forEach(g=>r.value.only.add(g))}function p(...d){d.forEach(g=>r.value.except.add(g)),d.forEach(g=>r.value.only.delete(g))}function o(d,g){if(u(d)||g===!1)return p(d);if(!u(d)||g===!0)return l(d)}function u(d){return r.value.all?!r.value.except.has(d):r.value.only.has(d)}const b=c.computed(()=>r.value.all&&r.value.except.size===0),P=c.computed(()=>r.value.only.size>0||b.value);function w(d){return{"onUpdate:modelValue":g=>{g?l(d):p(d)},modelValue:u(d),value:d}}function x(){return{"onUpdate:modelValue":d=>{d?f():s()},modelValue:b.value}}return{allSelected:b,selection:r,hasSelected:P,selectAll:f,deselectAll:s,select:l,deselect:p,toggle:o,selected:u,bind:w,bindAll:x}}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const J=()=>{};function ee(r,f){function s(...l){return new Promise((p,o)=>{Promise.resolve(r(()=>f.apply(this,l),{fn:f,thisArg:this,args:l})).then(p).catch(o)})}return s}function te(r,f={}){let s,l,p=J;const o=b=>{clearTimeout(b),p(),p=J};let u;return b=>{const P=c.toValue(r),w=c.toValue(f.maxWait);return s&&o(s),P<=0||w!==void 0&&w<=0?(l&&(o(l),l=null),Promise.resolve(b())):new Promise((x,d)=>{p=f.rejectOnCancel?d:x,u=b,w&&!l&&(l=setTimeout(()=>{s&&o(s),l=null,x(u())},w)),s=setTimeout(()=>{l&&o(l),l=null,x(b())},P)})}}function q(r,f=200,s={}){return ee(te(f,s),r)}function ne(r,f,s={}){const l=c.computed(()=>r[f]),p=c.computed(()=>!!l.value.sort),o=c.computed(()=>!!l.value.search),u=c.computed(()=>!!l.value.match),b=c.computed(()=>{var e;return(e=l.value.filters)==null?void 0:e.map(n=>({...n,apply:(a,m={})=>R(n,a,m),clear:(a={})=>N(n,a),bind:()=>$(n.name)}))}),P=c.computed(()=>{var e;return(e=l.value.sorts)==null?void 0:e.map(n=>({...n,apply:(a={})=>G(n,n.direction,a),clear:(a={})=>t(a),bind:()=>Q(n)}))}),w=c.computed(()=>{var e;return(e=l.value.searches)==null?void 0:e.map(n=>({...n,apply:(a={})=>M(n,a),clear:(a={})=>M(n,a),bind:()=>X(n)}))});function x(e){return e.filter(({active:n})=>n)}const d=c.computed(()=>x(l.value.filters)),g=c.computed(()=>{var e;return(e=x(l.value.sorts))==null?void 0:e[0]}),C=c.computed(()=>x(l.value.searches));function O(e){return Array.isArray(e)?e.join(l.value.delimiter):e}function W(e){return typeof e!="string"?e:e.trim().replace(/\s+/g,"+")}function h(e){if(!["",null,void 0,[]].includes(e))return e}function z(e){return[O,W,h].reduce((n,a)=>a(n),e)}function y(e,n){return n=Array.isArray(n)?n:[n],n.includes(e)?n.filter(a=>a!==e):[...n,e]}function L(e){var n;return typeof e!="string"?e:(n=l.value.filters)==null?void 0:n.find(({name:a})=>a===e)}function j(e,n=null){var a;return typeof e!="string"?e:(a=l.value.sorts)==null?void 0:a.find(({name:m,direction:k})=>m===e&&k===n)}function E(e){var n;return typeof e!="string"?e:(n=l.value.searches)==null?void 0:n.find(({name:a})=>a===e)}function F(e){return e?typeof e=="string"?d.value.some(n=>n.name===e):e.active:!!d.value.length}function B(e){var n;return e?typeof e=="string"?((n=g.value)==null?void 0:n.name)===e:e.active:!!g.value}function K(e){var n;return e?typeof e=="string"?(n=C.value)==null?void 0:n.some(a=>a.name===e):e.active:!!l.value.term}function D(e,n={}){const a=Object.fromEntries(Object.entries(e).map(([m,k])=>[m,z(k)]));S.router.reload({...s,...n,data:a})}function R(e,n,a={}){const m=L(e);if(!m)return console.warn(`Filter [${e}] does not exist.`);S.router.reload({...s,...a,data:{[m.name]:z(n)}})}function G(e,n=null,a={}){const m=j(e,n);if(!m)return console.warn(`Sort [${e}] does not exist.`);if(!p.value)return console.warn("Refine cannot perform sorting.");S.router.reload({...s,...a,data:{[l.value.sort]:h(m.next)}})}function U(e,n={}){if(e=[W,h].reduce((a,m)=>m(a),e),!o.value)return console.warn("Refine cannot perform searching.");S.router.reload({...s,...n,data:{[l.value.search]:e}})}function M(e,n={}){const a=E(e);if(!a)return console.warn(`Match [${e}] does not exist.`);if(!u.value||!o.value)return console.warn("Refine cannot perform matching.");const m=y(a.name,C.value.map(({name:k})=>k));S.router.reload({...s,...n,data:{[l.value.match]:O(m)}})}function N(e,n={}){if(e)return R(e,null,n);S.router.reload({...s,...n,data:Object.fromEntries(d.value.map(({name:a})=>[a,null]))})}function t(e={}){if(!p.value)return console.warn("Refine cannot perform sorting.");S.router.reload({...s,...e,data:{[l.value.sort]:null}})}function i(e={}){U(null,e)}function v(e={}){if(!u.value)return console.warn("Refine cannot perform matching.");S.router.reload({...s,...e,data:{[l.value.match]:null}})}function V(e={}){var n;S.router.reload({...s,...e,data:{[l.value.search??""]:void 0,[l.value.sort??""]:void 0,[l.value.match??""]:void 0,...Object.fromEntries(((n=l.value.filters)==null?void 0:n.map(a=>[a.name,void 0]))??[])}})}function $(e,n={}){const a=L(e);if(!a)return console.warn(`Filter [${e}] does not exist.`);const{debounce:m=250,transform:k=T=>T,...I}=n;return{"onUpdate:modelValue":q(T=>{R(a,k(T),I)},m),modelValue:a.value}}function Q(e,n={}){const a=j(e);if(!a)return console.warn(`Sort [${e}] does not exist.`);const{debounce:m=0,transform:k,...I}=n;return{onClick:q(()=>{var T;G(a,(T=g.value)==null?void 0:T.direction,I)},m)}}function re(e={}){const{debounce:n=700,transform:a,...m}=e;return{"onUpdate:modelValue":q(k=>{U(k,m)},n),modelValue:l.value.term??""}}function X(e,n={}){const a=E(e);if(!a)return console.warn(`Match [${e}] does not exist.`);const{debounce:m=0,transform:k,...I}=n;return{"onUpdate:modelValue":q(T=>{M(T,I)},m),modelValue:K(a),value:a.name}}return{filters:b,sorts:P,searches:w,currentFilters:d,currentSort:g,currentSearches:C,isSortable:p,isSearchable:o,isMatchable:u,isFiltering:F,isSorting:B,isSearching:K,getFilter:L,getSort:j,getSearch:E,apply:D,applyFilter:R,applySort:G,applySearch:U,applyMatch:M,clearFilter:N,clearSort:t,clearSearch:i,clearMatch:v,reset:V,bindFilter:$,bindSort:Q,bindSearch:re,bindMatch:X,stringValue:W,omitValue:h,toggleValue:y,delimitArray:O}}function le(r,f,s={}){if(!(r!=null&&r[f]))throw new Error("The table must be provided with valid props and key.");const{recordOperations:l={},...p}={only:[...s.only??[],f.toString()],...s},o=c.computed(()=>r[f]),u=Z(),b=ne(r,f,p),P=c.computed(()=>!!o.value.page&&!!o.value.record),w=c.computed(()=>!!o.value.column),x=c.computed(()=>o.value.columns.filter(({active:t,hidden:i})=>t&&!i).map(t=>{var i;return{...t,isSorting:!!((i=t.sort)!=null&&i.active),toggleSort:(v={})=>b.applySort(t.sort,null,v)}})),d=c.computed(()=>o.value.columns.filter(({hidden:t})=>!t).map(t=>({...t,toggle:(i={})=>G(t.name,i)}))),g=c.computed(()=>o.value.records.map(t=>({record:(({operations:i,...v})=>v)(t),operations:E(t.operations),default:(i={})=>{const v=t.operations.find(({default:V})=>V);v&&B(v,t,i)},select:()=>u.select(y(t)),deselect:()=>u.deselect(y(t)),toggle:()=>u.toggle(y(t)),selected:u.selected(y(t)),bind:()=>u.bind(y(t)),value:i=>{const v=L(i);return v in t?t[v].v:null},extra:i=>{const v=L(i);return console.log(v,t),v in t?t[v].e:null}}))),C=c.computed(()=>E(o.value.operations.bulk)),O=c.computed(()=>E(o.value.operations.page)),W=c.computed(()=>o.value.pages.find(({active:t})=>t)),h=c.computed(()=>({...o.value.paginate,next:(t={})=>{"nextLink"in h.value&&h.value.nextLink&&F(h.value.nextLink,t)},previous:(t={})=>{"prevLink"in h.value&&h.value.prevLink&&F(h.value.prevLink,t)},first:(t={})=>{"firstLink"in h.value&&h.value.firstLink&&F(h.value.firstLink,t)},last:(t={})=>{"lastLink"in h.value&&h.value.lastLink&&F(h.value.lastLink,t)},..."links"in o.value.paginate&&o.value.paginate.links?{links:o.value.paginate.links.map(t=>({...t,navigate:(i={})=>t.url&&F(t.url,i)}))}:{}})),z=c.computed(()=>o.value.records.length>0&&o.value.records.every(t=>u.selected(y(t))));function y(t){return t[o.value.key].v}function L(t){return typeof t=="string"?t:t.name}function j(t,i={},v={}){return H(t,o.value.endpoint,o.value.id,i,{...p,...v})}function E(t){return _(t,o.value.endpoint,o.value.id,p)}function F(t,i={}){S.router.visit(t,{preserveScroll:!0,preserveState:!0,...p,...i,method:"get"})}function B(t,i,v={}){var $;j(t,{record:y(i)},v)||($=l==null?void 0:l[t.name])==null||$.call(l,i)}function K(t,i={}){j(t,{all:u.selection.value.all,only:Array.from(u.selection.value.only),except:Array.from(u.selection.value.except)},{...i,onSuccess:v=>{var V;(V=i.onSuccess)==null||V.call(i,v),t.keepSelected||u.deselectAll()}})}function D(t,i={},v={}){return j(t,i,v)}function R(t,i={}){if(!P.value)return console.warn("The table does not support pagination changes.");S.router.reload({...p,...i,data:{[o.value.record]:t.value,[o.value.page]:void 0}})}function G(t,i={}){if(!w.value)return console.warn("The table does not support column toggling.");const v=L(t);if(!v)return console.log(`Column [${t}] does not exist.`);const V=b.toggleValue(v,x.value.map(({name:$})=>$));S.router.reload({...p,...i,data:{[o.value.column]:b.delimitArray(V)}})}function U(){u.select(...o.value.records.map(t=>y(t)))}function M(){u.deselect(...o.value.records.map(t=>y(t)))}function N(){return{"onUpdate:modelValue":t=>{t?U():M()},modelValue:z.value}}return c.reactive({table:o,getRecordKey:y,meta:o.value.meta,headings:x,columns:d,records:g,inline:o.value.operations.inline,bulk:C,page:O,pages:o.value.pages,currentPage:W,paginator:h,executeInline:B,executeBulk:K,executePage:D,applyPage:R,selection:u.selection,select:t=>u.select(y(t)),deselect:t=>u.deselect(y(t)),selectPage:U,deselectPage:M,toggle:t=>u.toggle(y(t)),selected:t=>u.selected(y(t)),selectAll:u.selectAll,deselectAll:u.deselectAll,isPageSelected:z,hasSelected:u.hasSelected,bindCheckbox:t=>u.bind(y(t)),bindPage:N,bindAll:u.bindAll,...b})}function ae(r,f){return r?typeof r=="object"?r.type===f:r===f:!1}A.is=ae,A.useTable=le,Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});
