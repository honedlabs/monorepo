(function(n,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue"),require("@inertiajs/vue3"),require("axios")):typeof define=="function"&&define.amd?define(["exports","vue","@inertiajs/vue3","axios"],t):(n=typeof globalThis<"u"?globalThis:n||self,t(n["@honed/modal"]={},n.Vue,n.Inertia,n.axios))})(this,function(n,t,h,d){"use strict";const m=t.ref(),y={setResolveCallback:e=>{m.value=e},resolve:e=>m.value(e)},C={install(e,o){y.setResolveCallback(o.resolve)}},i=h.usePage(),a=t.computed(()=>{var e;return(e=i==null?void 0:i.props)==null?void 0:e.modal}),R=t.computed(()=>{var e;return(e=a.value)==null?void 0:e.props}),v=t.computed(()=>{var e;return(e=a.value)==null?void 0:e.key}),s=t.ref(),u=t.shallowRef(),f=t.ref(!1),p=t.ref(),c=t.ref(),I=e=>{Object.entries(e).forEach(([o,r])=>["post","put","patch","delete"].forEach(l=>{d.defaults.headers[l][o]=r}))},L=()=>{["X-Inertia-Modal-Key","X-Inertia-Modal-Redirect"].forEach(([o,r])=>["get","post","put","patch","delete"].forEach(l=>{delete d.defaults.headers[l][o]}))},b=()=>{var e,o;I({"X-Inertia-Modal-Key":v.value,"X-Inertia-Modal-Redirect":(e=a.value)==null?void 0:e.redirectURL}),d.defaults.headers.get["X-Inertia-Modal-Redirect"]=((o=a.value)==null?void 0:o.redirectURL)??""},M=()=>{f.value=!1,L()},w=()=>{var e,o,r,l;if(c.value==((e=a.value)==null?void 0:e.nonce)||!((o=a.value)!=null&&o.component))return M();s.value!=((r=a.value)==null?void 0:r.component)&&(s.value=a.value.component,s.value?u.value=t.defineAsyncComponent(()=>y.resolve(s.value)):u.value=!1),c.value=(l=a.value)==null?void 0:l.nonce,p.value=u.value?t.h(u.value,{key:v.value,...R.value}):"",t.nextTick(()=>f.value=!0)};w(),typeof window<"u"&&window.addEventListener("popstate",e=>{c.value=null}),t.watch(a,()=>{var e;((e=a.value)==null?void 0:e.nonce)!==c.value&&w()},{deep:!0}),t.watch(v,b);const j=(e={})=>{var r,l;var o=((r=a.value)==null?void 0:r.redirectURL)??((l=a.value)==null?void 0:l.baseURL);if(p.value=!1,!!o)return h.router.visit(o,{preserveScroll:!0,preserveState:!0,...e})},k=()=>({show:f,vnode:p,close:M,redirect:j,props:R}),E=t.defineComponent({setup(){const{vnode:e}=k();return()=>e.value}});n.Modal=E,n.modal=C,n.useModal=k,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
