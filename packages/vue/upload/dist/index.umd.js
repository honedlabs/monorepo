(function(s,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("vue"),require("axios")):typeof define=="function"&&define.amd?define(["exports","vue","axios"],a):(s=typeof globalThis<"u"?globalThis:s||self,a(s["@honed/upload"]={},s.Vue,s.axios))})(this,function(s,a,g){"use strict";const b=(S,c={})=>{const v=a.ref(1),d=a.ref((c.files||[]).map((e,r)=>({...e,id:v.value++,remove:()=>m(r)}))),f=a.ref(!1),l=a.reactive({}),j=a.computed(()=>Object.keys(l).length>0);function p(e){e.forEach(r=>{h(r)})}function h(e){const r=v.value++,n=a.reactive({id:r,name:e.name,size:e.size,type:e.type,extension:e.name.split(".").pop(),progress:0,status:"pending",source:e,upload:()=>{y(n.source,{onStart:()=>n.status="uploading",onSuccess:()=>n.status="completed",onError:()=>n.status="error",onInvalid:()=>n.status="error",onProgress:o=>n.progress=o})},remove:()=>m(r)});d.value.unshift(n),c.waited||n.upload()}async function y(e,r={}){const n=(o,u)=>{var t,i;(t=c==null?void 0:c[o])==null||t.call(c,u),(i=r==null?void 0:r[o])==null||i.call(r,u)};n("onStart",e),g.post(S,{name:e.name,size:e.size,type:e.type,meta:{...c.meta,...r.meta}}).then(({data:o})=>{n("onPresign",o);const u=new FormData;Object.entries(o.inputs).forEach(([t,i])=>u.append(t,i)),u.append("file",e),g.post(o.attributes.action,u,{onUploadProgress:t=>{if(t.total){const i=Math.round(t.loaded*100/t.total);n("onProgress",i)}}}).then(({data:t})=>n("onSuccess",t)).catch(t=>n("onError",t))}).catch(o=>{Object.assign(l,o.response.data),n("onInvalid",o)}).finally(()=>n("onFinish"))}function m(e){d.value=d.value.filter(({id:r})=>r!==e)}function D(){d.value=[]}function E(){return{ondragover:e=>{e.preventDefault(),f.value=!0},ondrop:e=>{var r;e.preventDefault(),p(Array.from(((r=e.dataTransfer)==null?void 0:r.files)||[])),f.value=!1},ondragleave:e=>{e.preventDefault(),f.value=!1}}}function x(){return{type:"file",multiple:!1,onChange:e=>{const r=e.target;p(Array.from(r.files||[]))}}}function P(e){return typeof e=="string"?e:URL.createObjectURL(e)}return a.reactive({files:d,dragging:f,errors:l,hasErrors:j,addFiles:p,add:h,remove:m,clear:D,upload:y,toSource:P,bindInput:x,bindDrag:E})};s.useUpload=b,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
